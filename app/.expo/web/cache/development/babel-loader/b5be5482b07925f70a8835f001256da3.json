{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\workspace\\\\programming\\\\grocery-list\\\\app\\\\src\\\\contexts\\\\authContext.js\";\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { createContext, useState, useEffect } from 'react';\nimport AsyncStorage from '@react-native-community/async-storage';\nimport api from \"../services/api\";\nvar AuthContext = createContext({\n  signed: false,\n  user: {}\n});\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      user = _useState2[0],\n      setUser = _useState2[1];\n\n  var _useState3 = useState(true),\n      _useState4 = _slicedToArray(_useState3, 2),\n      loading = _useState4[0],\n      setLoading = _useState4[1];\n\n  useEffect(function () {\n    var loadStorage = function loadStorage() {\n      var storagedToken, storagedUser;\n      return _regeneratorRuntime.async(function loadStorage$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem('@MeuMercado:token'));\n\n            case 2:\n              storagedToken = _context.sent;\n              _context.next = 5;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem('@MeuMercado:user'));\n\n            case 5:\n              storagedUser = _context.sent;\n\n              if (storagedToken && storagedUser) {\n                api.defaults.headers['Authorization'] = \"Bearer \" + storagedToken;\n                setUser(JSON.parse(storagedUser));\n                setLoading(false);\n              } else {\n                setLoading(false);\n              }\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    loadStorage();\n  }, []);\n\n  var signIn = function signIn(email, password) {\n    var data, response;\n    return _regeneratorRuntime.async(function signIn$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            data = {\n              email: email,\n              password: password\n            };\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(api.post('/login', data));\n\n          case 4:\n            response = _context2.sent;\n            api.defaults.headers['Authorization'] = \"Bearer \" + response.data.token;\n            _context2.next = 8;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem('@MeuMercado:token', response.data.token));\n\n          case 8:\n            _context2.next = 10;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem('@MeuMercado:user', JSON.stringify(response.data.user)));\n\n          case 10:\n            setUser(response.data.user);\n            _context2.next = 16;\n            break;\n\n          case 13:\n            _context2.prev = 13;\n            _context2.t0 = _context2[\"catch\"](0);\n            console.log(_context2.t0);\n\n          case 16:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 13]], Promise);\n  };\n\n  var signOut = function signOut() {\n    return _regeneratorRuntime.async(function signOut$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            AsyncStorage.clear().then(function () {\n              setUser(null);\n            });\n\n          case 1:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  return React.createElement(AuthContext.Provider, {\n    value: {\n      loading: loading,\n      signed: Boolean(user),\n      user: user,\n      signIn: signIn,\n      signOut: signOut\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 5\n    }\n  }, children);\n};\nexport default AuthContext;","map":{"version":3,"sources":["C:/workspace/programming/grocery-list/app/src/contexts/authContext.js"],"names":["React","createContext","useState","useEffect","AsyncStorage","api","AuthContext","signed","user","AuthProvider","children","setUser","loading","setLoading","loadStorage","getItem","storagedToken","storagedUser","defaults","headers","JSON","parse","signIn","email","password","data","post","response","token","setItem","stringify","console","log","signOut","clear","then","Boolean"],"mappings":"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","sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\r\nimport AsyncStorage from '@react-native-community/async-storage';\r\n\r\nimport api from '../services/api';\r\n\r\nconst AuthContext = createContext({ signed: false, user: {} });\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const loadStorage = async () => {\r\n      const storagedToken = await AsyncStorage.getItem('@MeuMercado:token');\r\n      const storagedUser = await AsyncStorage.getItem('@MeuMercado:user');\r\n\r\n      if (storagedToken && storagedUser) {\r\n        api.defaults.headers['Authorization'] = `Bearer ${storagedToken}`;\r\n\r\n        setUser(JSON.parse(storagedUser));\r\n        setLoading(false);\r\n      } else {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadStorage();\r\n  }, []);\r\n\r\n  const signIn = async (email, password) => {\r\n    try {\r\n      const data = { email, password };\r\n      const response = await api.post('/login', data);\r\n\r\n      api.defaults.headers['Authorization'] = `Bearer ${response.data.token}`;\r\n\r\n      await AsyncStorage.setItem('@MeuMercado:token', response.data.token);\r\n      await AsyncStorage.setItem('@MeuMercado:user', JSON.stringify(response.data.user));\r\n\r\n      setUser(response.data.user);\r\n    } catch (Exception) {\r\n      console.log(Exception);\r\n    }\r\n  };\r\n\r\n  const signOut = async () => {\r\n    AsyncStorage.clear().then(() => {\r\n      setUser(null);\r\n    });\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ loading, signed: Boolean(user), user, signIn, signOut }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport default AuthContext;\r\n"]},"metadata":{},"sourceType":"module"}